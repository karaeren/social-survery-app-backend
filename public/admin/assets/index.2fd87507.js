import{d as S,a as p,r as y,u as k,o as L,E as u,b as h,c as d,e as g,f,w as T,g as w,h as x,R as O,i as E,j as N,k as U,l as b,m as A,n as P,p as $,s as B,q as I}from"./vendor.4b90bdc4.js";const C=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}};C();const v=S({id:"account",state:()=>({access:{expires:"",token:""},refresh:{expires:"",token:""},user:{id:"",email:"",name:"",role:""}}),getters:{},actions:{setTokens(a){this.access=a.access,this.refresh=a.refresh,this.saveTokensToLocalStorage()},setUser(a){this.user=a,this.saveUserToLocalStorage()},saveTokensToLocalStorage(){console.log("Saving Tokens..."),localStorage.setItem("ref",btoa(JSON.stringify(this.refresh)))},saveUserToLocalStorage(){console.log("Saving User..."),localStorage.setItem("usr",btoa(JSON.stringify(this.user)))},getFromLocalStorage(){const a=localStorage.getItem("ref");a&&(this.refresh=JSON.parse(atob(a)));const t=localStorage.getItem("usr");t&&(this.user=JSON.parse(atob(t)))},resetLocalStorage(){localStorage.removeItem("ref"),localStorage.removeItem("usr")}}});function R(){async function a(n,r){return(await p.post("https://socialsurveyapp.software/api/v1/auth/login",{email:n,password:r})).data}async function t(n){return(await p.post("https://socialsurveyapp.software/api/v1/auth/refresh-tokens",{refreshToken:n})).data}return{login:a,refreshTokens:t}}function V(){async function a(t,n){return(await p.get(`https://socialsurveyapp.software/api/v1/users/${n}`,{headers:{Authorization:`Bearer ${t}`}})).data}return{getUser:a}}const q={key:0,class:"page-loader"},J={setup(a){const t=v(),{refreshTokens:n}=R(),{getUser:r}=V(),e=y(!0),o=k();return L(async()=>{if(t.getFromLocalStorage(),t.refresh.token&&t.user.id){let s;try{s=await n(t.refresh.token)}catch(i){return console.error(i),u.alert("Please login again.","Session expired",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,o.push("login")}let c;try{c=await r(s.access.token,t.user.id)}catch(i){return console.error(i),u.alert("Please login again.","Unknwon error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,o.push("login")}if(c&&c.role==="admin")t.setTokens(s),t.setUser(c),e.value=!1;else return u.alert("User does not have required privileges!","Error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,o.push("login")}else o.push("login"),e.value=!1}),(s,c)=>{const i=h("loading"),_=h("el-icon");return d(),g("div",null,[e.value?(d(),g("div",q,[f(_,{class:"is-loading"},{default:T(()=>[f(i)]),_:1})])):w("",!0),f(x(O))])}}},K="modulepreload",m={},F="/admin/",H=function(t,n){return!n||n.length===0?t():Promise.all(n.map(r=>{if(r=`${F}${r}`,r in m)return;m[r]=!0;const e=r.endsWith(".css"),o=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const s=document.createElement("link");if(s.rel=e?"stylesheet":K,e||(s.as="script",s.crossOrigin=""),s.href=r,document.head.appendChild(s),e)return new Promise((c,i)=>{s.addEventListener("load",c),s.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())},D=N("Home page "),M={setup(a){const t=v();function n(){t.resetLocalStorage(),location.reload()}return(r,e)=>(d(),g("main",null,[D,E("a",{href:"#",onClick:n},"Logout")]))}},W=U({history:b(),routes:[{path:"/",name:"home",component:M},{path:"/login",name:"login",component:()=>H(()=>import("./LoginView.1b6ec787.js"),["assets/LoginView.1b6ec787.js","assets/LoginView.76e75d53.css","assets/vendor.4b90bdc4.js"])}]});const l=A(J);l.use(P());l.use(W);l.use($);l.component("search",B).component("loading",I);l.mount("#app");export{R as a,v as u};
