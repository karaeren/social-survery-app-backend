import{d as I,E as O,a as A,b,c as P,o as g,e as h,f as o,w as r,u as p,R,g as V,h as C,i as k,j as U,k as _,l as x,m as N,n as B,p as v,r as D,q as $,s as M,t as q,v as F,x as m,y as J,z as K,A as L,B as j,C as z,D as H,F as W}from"./vendor.07862786.js";const G=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function l(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(e){if(e.ep)return;e.ep=!0;const a=l(e);fetch(e.href,a)}};G();const T=I({id:"account",state:()=>({access:{expires:"",token:""},refresh:{expires:"",token:""},user:{id:"",email:"",name:"",role:""},loggedIn:!1}),getters:{},actions:{setTokens(i){this.access=i.access,this.refresh=i.refresh,this.saveTokensToLocalStorage()},setUser(i){this.user=i,this.saveUserToLocalStorage()},saveTokensToLocalStorage(){console.log("Saving Tokens..."),localStorage.setItem("ref",btoa(JSON.stringify(this.refresh)))},saveUserToLocalStorage(){console.log("Saving User..."),localStorage.setItem("usr",btoa(JSON.stringify(this.user)))},getFromLocalStorage(){const i=localStorage.getItem("ref");i&&(this.refresh=JSON.parse(atob(i)));const t=localStorage.getItem("usr");t&&(this.user=JSON.parse(atob(t)))},resetLocalStorage(){localStorage.removeItem("ref"),localStorage.removeItem("usr")}}});const Q=U("div",{class:"logo"},"Social Survey App",-1),X=_("Surveys "),Y=_("List Surveys"),Z=_("Create a Survey"),ee=_("Categories"),te=_(" List Categories "),se=_(" Create a Category "),oe=_("Users "),re=_("List Users"),ae=_(" Logout "),ne={name:"MainView"},ie=Object.assign(ne,{setup(i){const t=T();function l(){t.resetLocalStorage(),location.reload()}return(n,e)=>{const a=x,s=O,c=A,u=b,d=P,w=N,S=B;return g(),h("div",null,[o(S,{class:"layout-container-main"},{default:r(()=>[o(w,{width:"256px"},{default:r(()=>[o(d,null,{default:r(()=>[o(u,{"default-openeds":["surveys","surveys-categories","users"],style:{"min-height":"100vh"},router:!0},{default:r(()=>[o(p(R),{to:"/"},{default:r(()=>[Q]),_:1}),o(c,{index:"surveys"},{title:r(()=>[o(a,null,{default:r(()=>[o(p(V))]),_:1}),X]),default:r(()=>[o(s,{index:"list-surveys"},{default:r(()=>[Y]),_:1}),o(s,{index:"create-survey"},{default:r(()=>[Z]),_:1}),o(c,{index:"surveys-categories"},{title:r(()=>[ee]),default:r(()=>[o(s,{index:"list-categories"},{default:r(()=>[te]),_:1}),o(s,{index:"create-category"},{default:r(()=>[se]),_:1})]),_:1})]),_:1}),o(c,{index:"users"},{title:r(()=>[o(a,null,{default:r(()=>[o(p(C))]),_:1}),oe]),default:r(()=>[o(s,{index:"list-users"},{default:r(()=>[re]),_:1})]),_:1}),o(s,{index:"logout",class:"bottom-item",onClick:l},{default:r(()=>[ae]),_:1})]),_:1})]),_:1})]),_:1}),o(S,null,{default:r(()=>[o(p(k))]),_:1})]),_:1})])}}});function le(){async function i(l,n){return(await v.post("https://socialsurveyapp.software/api/v1/auth/login",{email:l,password:n})).data}async function t(l){return(await v.post("https://socialsurveyapp.software/api/v1/auth/refresh-tokens",{refreshToken:l})).data}return{login:i,refreshTokens:t}}function ce(){async function i(t,l){return(await v.get(`https://socialsurveyapp.software/api/v1/users/${l}`,{headers:{Authorization:`Bearer ${t}`}})).data}return{getUser:i}}const ue={key:0,class:"page-loader"},_e={setup(i){const t=T(),{refreshTokens:l}=le(),{getUser:n}=ce(),e=D(!0),a=$(),s=M();return q(()=>a.name,async c=>{c==="login"&&t.loggedIn&&s.push("/")}),F(async()=>{if(t.getFromLocalStorage(),t.refresh.token&&t.user.id){let c;try{c=await l(t.refresh.token)}catch(d){return console.error(d),m.alert("Please login again.","Session expired",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}let u;try{u=await n(c.access.token,t.user.id)}catch(d){return console.error(d),m.alert("Please login again.","Unknwon error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}if(u&&u.role==="admin"){t.setTokens(c),t.setUser(u),e.value=!1,t.loggedIn=!0,a.name==="login"&&s.push("/");return}else return m.alert("User does not have required privileges!","Error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}else s.push("login"),e.value=!1}),(c,u)=>{const d=x;return g(),h("div",null,[e.value?(g(),h("div",ue,[o(d,{class:"is-loading"},{default:r(()=>[o(p(J))]),_:1})])):K("",!0),p(t).loggedIn?(g(),L(ie,{key:2})):(g(),L(p(k),{key:1}))])}}},de="modulepreload",E={},fe="/admin/",f=function(t,l){return!l||l.length===0?t():Promise.all(l.map(n=>{if(n=`${fe}${n}`,n in E)return;E[n]=!0;const e=n.endsWith(".css"),a=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${a}`))return;const s=document.createElement("link");if(s.rel=e?"stylesheet":de,e||(s.as="script",s.crossOrigin=""),s.href=n,document.head.appendChild(s),e)return new Promise((c,u)=>{s.addEventListener("load",c),s.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())},pe=j({history:z(),routes:[{path:"/",name:"home",component:()=>f(()=>import("./HomeView.d2ac12af.js"),["assets/HomeView.d2ac12af.js","assets/ListUsers.37c1b5f4.css","assets/el-card.58e797c5.css","assets/vendor.07862786.js","assets/vendor.fb521127.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/login",name:"login",component:()=>f(()=>import("./LoginView.311892d7.js"),["assets/LoginView.311892d7.js","assets/LoginView.76e75d53.css","assets/el-card.58e797c5.css","assets/el-form-item.1c8e9085.css","assets/vendor.07862786.js","assets/vendor.fb521127.css"])},{path:"/list-surveys",name:"list-surveys",component:()=>f(()=>import("./ListSurveys.1d8e9a71.js"),["assets/ListSurveys.1d8e9a71.js","assets/ListSurveys.7b7afa72.css","assets/el-form-item.1c8e9085.css","assets/vendor.07862786.js","assets/vendor.fb521127.css"])},{path:"/create-survey",name:"create-survey",component:()=>f(()=>import("./CreateSurvey.8b56fec7.js"),["assets/CreateSurvey.8b56fec7.js","assets/ListUsers.37c1b5f4.css","assets/el-card.58e797c5.css","assets/vendor.07862786.js","assets/vendor.fb521127.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/list-categories",name:"list-categories",component:()=>f(()=>import("./ListCategories.d04588b4.js"),["assets/ListCategories.d04588b4.js","assets/ListUsers.37c1b5f4.css","assets/el-card.58e797c5.css","assets/vendor.07862786.js","assets/vendor.fb521127.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/create-category",name:"create-category",component:()=>f(()=>import("./CreateCategory.6c497850.js"),["assets/CreateCategory.6c497850.js","assets/ListUsers.37c1b5f4.css","assets/el-card.58e797c5.css","assets/vendor.07862786.js","assets/vendor.fb521127.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/list-users",name:"list-users",component:()=>f(()=>import("./ListUsers.f775f6ad.js"),["assets/ListUsers.f775f6ad.js","assets/ListUsers.37c1b5f4.css","assets/el-card.58e797c5.css","assets/vendor.07862786.js","assets/vendor.fb521127.css","assets/plugin-vue_export-helper.21dcd24c.js"])}]});const y=H(_e);y.use(W());y.use(pe);y.mount("#app");export{le as a,T as u};
