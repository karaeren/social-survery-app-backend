var X=Object.defineProperty,Y=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var I=(i,o,l)=>o in i?X(i,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[o]=l,v=(i,o)=>{for(var l in o||(o={}))H.call(o,l)&&I(i,l,o[l]);if(A)for(var l of A(o))Z.call(o,l)&&I(i,l,o[l]);return i},U=(i,o)=>Y(i,q(o));import{p as S,r as b,N as ee,O as te,v as ae,x as C,P as oe,I as ne,K as re,Q as se,J as le,S as ie,T as ue,L as ce,U as de,o as T,e as z,j as O,f as a,u as f,w as s,V as L,W as pe,k,X as D,A as me}from"./vendor.07862786.js";/* empty css                     */import{u as ye}from"./index.4c4f3f40.js";function ve(){async function i(p,m,u,c,d,_=1e3,x=1){return(await S.get("https://socialsurveyapp.software/api/v1/survey",{params:U(v(v(v(v({},m&&{name:m}),u&&{searchForName:u}),c&&{categoryId:c}),d&&{sortBy:d}),{limit:_,page:x}),headers:{Authorization:`Bearer ${p}`}})).data}async function o(p,m,u,c,d){return(await S.patch(`https://socialsurveyapp.software/api/v1/survey/${m}`,v(v(v({},u&&{name:u}),c&&{description:c}),d&&{categoryId:d}),{headers:{Authorization:`Bearer ${p}`}})).data}async function l(p,m){return(await S.delete(`https://socialsurveyapp.software/api/v1/survey/${m}`,{headers:{Authorization:`Bearer ${p}`}})).data}async function V(p){return(await S.get("https://socialsurveyapp.software/api/v1/survey/categories",{headers:{Authorization:`Bearer ${p}`}})).data}return{getSurveys:i,updateSurvey:o,deleteSurvey:l,getCategories:V}}const fe={class:"main centered-main"},_e=k(" Results "),ge=k(" Edit "),he=k(" Delete "),we={class:"dialog-footer"},be=k("Cancel"),Ce=k(" Update "),Be={setup(i){const o=ye(),{getSurveys:l,updateSurvey:V,deleteSurvey:p,getCategories:m}=ve(),u=b([]),c=b([]),d=b([]),_=b(""),x=ee(()=>d.value.filter(t=>!_.value||t.name.toLowerCase().includes(_.value.toLowerCase()))),g=b(!1),r=te({id:"",name:"",description:"",category:""});ae(async()=>{if(!!o.access.token){try{u.value=await m(o.access.token)}catch(t){return console.error(t),C.alert("An unknown error happened while trying to retrieve categories...","Error",{confirmButtonText:"OK"})}for await(const t of u.value)c.value.push({id:t.id,text:t.name,value:t.name});await B()}});async function B(){d.value=[];let t;try{t=await l(o.access.token)}catch(e){return console.error(e),C.alert("An unknown error happened while trying to retrieve list of surveys...","Error",{confirmButtonText:"OK"})}await K(t)}async function K(t){for await(const e of t.results){const y=u.value.filter(h=>h.id===e.categoryId);d.value.push({id:e.id,name:e.name,description:e.description,categoryId:e.categoryId,category:y.length?y[0].name:"Unknown Category",submissionCount:e.submissionCount})}}function N(t,e){return e.category===t}function F(t){window.open(`https://socialsurveyapp.software/results.html?surveyId=${t}`,"_blank")}function M(t){for(const e of d.value)if(e.id===t){r.id=t,r.name=e.name,r.description=e.description,r.category=e.categoryId,g.value=!0;return}}async function P(){try{await V(o.access.token,r.id,r.name,r.description,r.category),D({type:"success",message:"Survey updated"}),await B(),g.value=!1}catch(t){return console.error(t),C.alert("Couldn't update survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}function R(t){C.confirm("Are you sure you want to delete this survey? This is irreversible!","Warning",{confirmButtonText:"Yes",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{try{await p(o.access.token,t),D({type:"success",message:"Delete completed"}),await B()}catch(e){return console.error(e),C.alert("Couldn't delete survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}).catch(()=>{D({type:"info",message:"Delete canceled"})})}return(t,e)=>{const y=oe,h=ne,w=re,W=se,E=le,j=ie,G=ue,J=ce,Q=de;return T(),z(L,null,[O("div",fe,[a(W,{data:f(x),height:"100vh",style:{width:"100%"}},{default:s(()=>[a(y,{fixed:"",prop:"name",label:"Name",sortable:"",width:"240"}),a(y,{prop:"description",label:"Description",width:"360"}),a(y,{prop:"submissionCount",label:"Submission Count",width:"240"}),a(y,{prop:"category",label:"Category",sortable:"",filters:c.value,"filter-method":N,width:"240"},null,8,["filters"]),a(y,{prop:"id",label:"ID",sortable:"",width:"360"}),a(y,{fixed:"right",align:"right","min-width":"240"},{header:s(()=>[a(h,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n),size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:s(n=>[a(w,{type:"success",size:"small",onClick:$=>F(n.row.id)},{default:s(()=>[_e]),_:2},1032,["onClick"]),a(w,{type:"primary",size:"small",onClick:$=>M(n.row.id)},{default:s(()=>[ge]),_:2},1032,["onClick"]),a(w,{type:"danger",size:"small",onClick:$=>R(n.row.id)},{default:s(()=>[he]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),a(Q,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=n=>g.value=n),title:"Update Survey"},{footer:s(()=>[O("span",we,[a(w,{onClick:e[4]||(e[4]=n=>g.value=!1)},{default:s(()=>[be]),_:1}),a(w,{type:"primary",onClick:P},{default:s(()=>[Ce]),_:1})])]),default:s(()=>[a(J,{model:f(r)},{default:s(()=>[a(E,{label:"Name","label-width":"140px"},{default:s(()=>[a(h,{modelValue:f(r).name,"onUpdate:modelValue":e[1]||(e[1]=n=>f(r).name=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(E,{label:"Description","label-width":"140px"},{default:s(()=>[a(h,{modelValue:f(r).description,"onUpdate:modelValue":e[2]||(e[2]=n=>f(r).description=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(E,{label:"Category","label-width":"140px"},{default:s(()=>[a(G,{modelValue:f(r).category,"onUpdate:modelValue":e[3]||(e[3]=n=>f(r).category=n),placeholder:"Please select a category"},{default:s(()=>[(T(!0),z(L,null,pe(c.value,n=>(T(),me(j,{key:n.id,label:n.value,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{Be as default};
