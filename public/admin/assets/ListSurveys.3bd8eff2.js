import{r as p,N as R,O as W,v as j,x as m,P as J,I as Q,K as X,Q as Y,J as q,S as G,T as H,L as Z,U as ee,o as b,c as V,i as x,e as o,u as s,w as n,V as E,W as te,j as f,X as C,A as oe}from"./vendor.2f5e2848.js";/* empty css                     */import{u as ae}from"./survey.9daf437d.js";import{u as le}from"./index.abe41e06.js";const ne={class:"main centered-main"},re=f(" Results "),se=f(" Edit "),ie=f(" Delete "),ue={class:"dialog-footer"},ce=f("Cancel"),de=f(" Update "),_e={setup(pe){const i=le(),{getSurveys:T,updateSurvey:D,deleteSurvey:S,getCategories:B}=ae(),_=p([]),g=p([]),y=p([]),v=p(""),I=R(()=>y.value.filter(t=>!v.value||t.name.toLowerCase().includes(v.value.toLowerCase()))),u=p(!1),l=W({id:"",name:"",description:"",category:""});j(async()=>{if(!!i.access.token){try{_.value=await B(i.access.token)}catch(t){return console.error(t),m.alert("An unknown error happened while trying to retrieve categories...","Error",{confirmButtonText:"OK"})}for await(const t of _.value)g.value.push({id:t.id,text:t.name,value:t.name});await w()}});async function w(){y.value=[];let t;try{t=await T(i.access.token)}catch(e){return console.error(e),m.alert("An unknown error happened while trying to retrieve list of surveys...","Error",{confirmButtonText:"OK"})}await U(t)}async function U(t){for await(const e of t.results){const r=_.value.filter(c=>c.id===e.categoryId);y.value.push({id:e.id,name:e.name,description:e.description,categoryId:e.categoryId,category:r.length?r[0].name:"Unknown Category",submissionCount:e.submissionCount})}}function A(t,e){return e.category===t}function N(t){window.open(`https://socialsurveyapp.software/results.html?surveyId=${t}`,"_blank")}function O(t){for(const e of y.value)if(e.id===t){l.id=t,l.name=e.name,l.description=e.description,l.category=e.categoryId,u.value=!0;return}}async function K(){try{await D(i.access.token,l.id,l.name,l.description,l.category),C({type:"success",message:"Survey updated"}),await w(),u.value=!1}catch(t){return console.error(t),m.alert("Couldn't update survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}function L(t){m.confirm("Are you sure you want to delete this survey? This is irreversible!","Warning",{confirmButtonText:"Yes",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{try{await S(i.access.token,t),C({type:"success",message:"Delete completed"}),await w()}catch(e){return console.error(e),m.alert("Couldn't delete survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}).catch(()=>{C({type:"info",message:"Delete canceled"})})}return(t,e)=>{const r=J,c=Q,d=X,$=Y,h=q,z=G,F=H,M=Z,P=ee;return b(),V(E,null,[x("div",ne,[o($,{data:s(I),height:"100vh",style:{width:"100%"}},{default:n(()=>[o(r,{fixed:"",prop:"name",label:"Name",sortable:"",width:"240"}),o(r,{prop:"description",label:"Description",width:"360"}),o(r,{prop:"submissionCount",label:"Submission Count",width:"240"}),o(r,{prop:"category",label:"Category",sortable:"",filters:g.value,"filter-method":A,width:"240"},null,8,["filters"]),o(r,{prop:"id",label:"ID",sortable:"",width:"360"}),o(r,{fixed:"right",align:"right","min-width":"240"},{header:n(()=>[o(c,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:n(a=>[o(d,{type:"success",size:"small",onClick:k=>N(a.row.id)},{default:n(()=>[re]),_:2},1032,["onClick"]),o(d,{type:"primary",size:"small",onClick:k=>O(a.row.id)},{default:n(()=>[se]),_:2},1032,["onClick"]),o(d,{type:"danger",size:"small",onClick:k=>L(a.row.id)},{default:n(()=>[ie]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),o(P,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value=a),title:"Update Survey"},{footer:n(()=>[x("span",ue,[o(d,{onClick:e[4]||(e[4]=a=>u.value=!1)},{default:n(()=>[ce]),_:1}),o(d,{type:"primary",onClick:K},{default:n(()=>[de]),_:1})])]),default:n(()=>[o(M,{model:s(l)},{default:n(()=>[o(h,{label:"Name","label-width":"140px"},{default:n(()=>[o(c,{modelValue:s(l).name,"onUpdate:modelValue":e[1]||(e[1]=a=>s(l).name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(h,{label:"Description","label-width":"140px"},{default:n(()=>[o(c,{modelValue:s(l).description,"onUpdate:modelValue":e[2]||(e[2]=a=>s(l).description=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(h,{label:"Category","label-width":"140px"},{default:n(()=>[o(F,{modelValue:s(l).category,"onUpdate:modelValue":e[3]||(e[3]=a=>s(l).category=a),placeholder:"Please select a category"},{default:n(()=>[(b(!0),V(E,null,te(g.value,a=>(b(),oe(z,{key:a.id,label:a.value,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{_e as default};
