import{d as w,E as O,a as A,b,c as P,o as m,e as h,f as o,w as r,u as p,R,g as V,h as C,i as k,j as U,k as _,l as x,m as N,n as B,p as v,r as D,q as $,s as M,t as q,v as F,x as g,y as J,z as K,A as L,B as j,C as z,D as H,F as W}from"./vendor.9b493a68.js";const G=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function c(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(e){if(e.ep)return;e.ep=!0;const n=c(e);fetch(e.href,n)}};G();const T=w({id:"account",state:()=>({access:{expires:"",token:""},refresh:{expires:"",token:""},user:{id:"",email:"",name:"",role:""},loggedIn:!1}),getters:{},actions:{setTokens(i){this.access=i.access,this.refresh=i.refresh,this.saveTokensToLocalStorage()},setUser(i){this.user=i,this.saveUserToLocalStorage()},saveTokensToLocalStorage(){console.log("Saving Tokens..."),localStorage.setItem("ref",btoa(JSON.stringify(this.refresh)))},saveUserToLocalStorage(){console.log("Saving User..."),localStorage.setItem("usr",btoa(JSON.stringify(this.user)))},getFromLocalStorage(){const i=localStorage.getItem("ref");i&&(this.refresh=JSON.parse(atob(i)));const t=localStorage.getItem("usr");t&&(this.user=JSON.parse(atob(t)))},resetLocalStorage(){localStorage.removeItem("ref"),localStorage.removeItem("usr")}}});const Q=U("div",{class:"logo"},"Social Survey App",-1),X=_("Surveys "),Y=_("List Surveys"),Z=_("Create a Survey"),ee=_("Categories"),te=_(" List Categories "),se=_(" Create a Category "),oe=_("Users "),re=_("List Users"),ae=_(" Logout "),ne={name:"MainView"},ie=Object.assign(ne,{setup(i){const t=T();function c(){t.resetLocalStorage(),location.reload()}return(a,e)=>{const n=x,s=O,l=A,u=b,d=P,I=N,S=B;return m(),h("div",null,[o(S,{class:"layout-container-main"},{default:r(()=>[o(I,{width:"256px"},{default:r(()=>[o(d,null,{default:r(()=>[o(u,{"default-openeds":["surveys","surveys-categories","users"],"default-active":a.activeItem,style:{"min-height":"100vh"},router:"true"},{default:r(()=>[o(p(R),{to:"/"},{default:r(()=>[Q]),_:1}),o(l,{index:"surveys"},{title:r(()=>[o(n,null,{default:r(()=>[o(p(V))]),_:1}),X]),default:r(()=>[o(s,{index:"list-surveys"},{default:r(()=>[Y]),_:1}),o(s,{index:"create-survey"},{default:r(()=>[Z]),_:1}),o(l,{index:"surveys-categories"},{title:r(()=>[ee]),default:r(()=>[o(s,{index:"list-categories"},{default:r(()=>[te]),_:1}),o(s,{index:"create-category"},{default:r(()=>[se]),_:1})]),_:1})]),_:1}),o(l,{index:"users"},{title:r(()=>[o(n,null,{default:r(()=>[o(p(C))]),_:1}),oe]),default:r(()=>[o(s,{index:"list-users"},{default:r(()=>[re]),_:1})]),_:1}),o(s,{index:"logout",class:"bottom-item",onClick:c},{default:r(()=>[ae]),_:1})]),_:1},8,["default-active"])]),_:1})]),_:1}),o(S,null,{default:r(()=>[o(p(k))]),_:1})]),_:1})])}}});function ce(){async function i(c,a){return(await v.post("https://socialsurveyapp.software/api/v1/auth/login",{email:c,password:a})).data}async function t(c){return(await v.post("https://socialsurveyapp.software/api/v1/auth/refresh-tokens",{refreshToken:c})).data}return{login:i,refreshTokens:t}}function le(){async function i(t,c){return(await v.get(`https://socialsurveyapp.software/api/v1/users/${c}`,{headers:{Authorization:`Bearer ${t}`}})).data}return{getUser:i}}const ue={key:0,class:"page-loader"},_e={setup(i){const t=T(),{refreshTokens:c}=ce(),{getUser:a}=le(),e=D(!0),n=$(),s=M();return q(()=>n.name,async l=>{l==="login"&&t.loggedIn&&s.push("/")}),F(async()=>{if(t.getFromLocalStorage(),t.refresh.token&&t.user.id){let l;try{l=await c(t.refresh.token)}catch(d){return console.error(d),g.alert("Please login again.","Session expired",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}let u;try{u=await a(l.access.token,t.user.id)}catch(d){return console.error(d),g.alert("Please login again.","Unknwon error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}return u&&u.role==="admin"?(t.setTokens(l),t.setUser(u),e.value=!1,t.loggedIn=!0,s.push("/")):(g.alert("User does not have required privileges!","Error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login"))}else s.push("login"),e.value=!1}),(l,u)=>{const d=x;return m(),h("div",null,[e.value?(m(),h("div",ue,[o(d,{class:"is-loading"},{default:r(()=>[o(p(J))]),_:1})])):K("",!0),p(t).loggedIn?(m(),L(ie,{key:2})):(m(),L(p(k),{key:1}))])}}},de="modulepreload",E={},fe="/admin/",f=function(t,c){return!c||c.length===0?t():Promise.all(c.map(a=>{if(a=`${fe}${a}`,a in E)return;E[a]=!0;const e=a.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${n}`))return;const s=document.createElement("link");if(s.rel=e?"stylesheet":de,e||(s.as="script",s.crossOrigin=""),s.href=a,document.head.appendChild(s),e)return new Promise((l,u)=>{s.addEventListener("load",l),s.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())},pe=j({history:z(),routes:[{path:"/",name:"home",component:()=>f(()=>import("./HomeView.045c64ee.js"),["assets/HomeView.045c64ee.js","assets/HomeView.8e6928ab.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/login",name:"login",component:()=>f(()=>import("./LoginView.af636e3c.js"),["assets/LoginView.af636e3c.js","assets/LoginView.95e78a10.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css"])},{path:"/list-surveys",name:"list-surveys",component:()=>f(()=>import("./ListSurveys.646c14b8.js"),["assets/ListSurveys.646c14b8.js","assets/HomeView.8e6928ab.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/create-survey",name:"create-survey",component:()=>f(()=>import("./CreateSurvey.8864e955.js"),["assets/CreateSurvey.8864e955.js","assets/HomeView.8e6928ab.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/list-categories",name:"list-categories",component:()=>f(()=>import("./ListCategories.5cd55899.js"),["assets/ListCategories.5cd55899.js","assets/HomeView.8e6928ab.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/create-category",name:"create-category",component:()=>f(()=>import("./CreateCategory.ead5b516.js"),["assets/CreateCategory.ead5b516.js","assets/HomeView.8e6928ab.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/list-users",name:"list-users",component:()=>f(()=>import("./ListUsers.7c6e46cf.js"),["assets/ListUsers.7c6e46cf.js","assets/HomeView.8e6928ab.css","assets/el-card.58e797c5.css","assets/vendor.9b493a68.js","assets/vendor.c18b3912.css","assets/plugin-vue_export-helper.21dcd24c.js"])}]});const y=H(_e);y.use(W());y.use(pe);y.mount("#app");export{ce as a,T as u};
