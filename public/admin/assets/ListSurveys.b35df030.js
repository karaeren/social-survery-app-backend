import{r as m,N as R,O as W,v as j,x as f,P as G,I as J,K as Q,Q as X,J as q,S as H,T as Z,U as ee,L as te,V as ae,o as b,c as k,i as C,e as t,u as s,w as n,W as V,X as oe,j as u,Y as x,A as le}from"./vendor.9334939d.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css               *//* empty css                        */import{u as ne}from"./index.7c68fd32.js";import{u as re}from"./survey.b7f4628a.js";const se={class:"main centered-main"},ie=u(" Results "),ue=u(" Edit "),de=u(" Delete "),ce=u(" Remove Expiration "),pe={class:"dialog-footer"},me=u("Cancel"),fe=u(" Update "),ke={setup(ye){const d=ne(),{getSurveys:E,updateSurvey:S,deleteSurvey:T,getCategories:B}=re(),v=m([]),w=m([]),y=m([]),_=m(""),I=R(()=>y.value.filter(a=>!_.value||a.name.toLowerCase().includes(_.value.toLowerCase()))),c=m(!1),l=W({id:"",name:"",description:"",category:"",expireDate:null});j(async()=>{if(!!d.access.token){try{v.value=await B(d.access.token)}catch(a){return console.error(a),f.alert("An unknown error happened while trying to retrieve categories...","Error",{confirmButtonText:"OK"})}for await(const a of v.value)w.value.push({id:a.id,text:a.name,value:a.name});await h()}});async function h(){y.value=[];let a;try{a=await E(d.access.token)}catch(e){return console.error(e),f.alert("An unknown error happened while trying to retrieve list of surveys...","Error",{confirmButtonText:"OK"})}await F(a)}async function F(a){for await(const e of a.results){const r=v.value.filter(p=>p.id===e.categoryId);y.value.push({id:e.id,name:e.name,description:e.description,categoryId:e.categoryId,expireDate:e.expireDate?new Date(e.expireDate).toISOString().split("T")[0]:null,numFeatures:e.geoFeatures?e.geoFeatures.length:0,geoFeatures:e.geoFeatures,category:r.length?r[0].name:"Unknown Category",submissionCount:e.submissionCount})}}function U(a,e){return e.category===a}function Y(a){window.open(`https://socialsurveyapp.software/results.html?surveyId=${a}`,"_blank")}function M(a){for(const e of y.value)if(e.id===a){l.id=a,l.name=e.name,l.description=e.description,l.category=e.categoryId,l.expireDate=e.expireDate,c.value=!0;return}}async function O(){try{await S(d.access.token,l.id,l.name,l.description,l.category,l.expireDate),x({type:"success",message:"Survey updated"}),await h(),c.value=!1}catch(a){return console.error(a),f.alert("Couldn't update survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}function A(a){f.confirm("Are you sure you want to delete this survey? This is irreversible!","Warning",{confirmButtonText:"Yes",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{try{await T(d.access.token,a),x({type:"success",message:"Delete completed"}),await h()}catch(e){return console.error(e),f.alert("Couldn't delete survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}).catch(()=>{x({type:"info",message:"Delete canceled"})})}return(a,e)=>{const r=G,p=J,i=Q,N=X,g=q,$=H,K=Z,L=ee,z=te,P=ae;return b(),k(V,null,[C("div",se,[t(N,{data:s(I),height:"100vh",style:{width:"100%"}},{default:n(()=>[t(r,{fixed:"",prop:"name",label:"Name",sortable:"",width:"240"}),t(r,{prop:"description",label:"Description",width:"360"}),t(r,{prop:"expireDate",label:"Expire Date",width:"240"}),t(r,{prop:"numFeatures",label:"Geographic Features",width:"240"}),t(r,{prop:"submissionCount",label:"Submission Count",width:"240"}),t(r,{prop:"category",label:"Category",sortable:"",filters:w.value,"filter-method":U,width:"240"},null,8,["filters"]),t(r,{prop:"id",label:"ID",sortable:"",width:"360"}),t(r,{fixed:"right",align:"right","min-width":"240"},{header:n(()=>[t(p,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:n(o=>[t(i,{type:"success",size:"small",onClick:D=>Y(o.row.id)},{default:n(()=>[ie]),_:2},1032,["onClick"]),t(i,{type:"primary",size:"small",onClick:D=>M(o.row.id)},{default:n(()=>[ue]),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:D=>A(o.row.id)},{default:n(()=>[de]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(P,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=o=>c.value=o),title:"Update Survey"},{footer:n(()=>[C("span",pe,[t(i,{onClick:e[6]||(e[6]=o=>c.value=!1)},{default:n(()=>[me]),_:1}),t(i,{type:"primary",onClick:O},{default:n(()=>[fe]),_:1})])]),default:n(()=>[t(z,{model:s(l)},{default:n(()=>[t(g,{label:"Name","label-width":"140px"},{default:n(()=>[t(p,{modelValue:s(l).name,"onUpdate:modelValue":e[1]||(e[1]=o=>s(l).name=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(g,{label:"Description","label-width":"140px"},{default:n(()=>[t(p,{modelValue:s(l).description,"onUpdate:modelValue":e[2]||(e[2]=o=>s(l).description=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(g,{label:"Category","label-width":"140px"},{default:n(()=>[t(K,{modelValue:s(l).category,"onUpdate:modelValue":e[3]||(e[3]=o=>s(l).category=o),placeholder:"Please select a category"},{default:n(()=>[(b(!0),k(V,null,oe(w.value,o=>(b(),le($,{key:o.id,label:o.value,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"Expiration Date","label-width":"140px"},{default:n(()=>[t(L,{modelValue:s(l).expireDate,"onUpdate:modelValue":e[4]||(e[4]=o=>s(l).expireDate=o),type:"date",placeholder:"Pick a day",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),t(i,{style:{"margin-left":"1em"},onClick:e[5]||(e[5]=o=>s(l).expireDate=null)},{default:n(()=>[ce]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{ke as default};
