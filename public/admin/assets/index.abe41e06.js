import{d as b,E as I,a as A,b as V,o as h,c as m,e as o,w as r,u as f,R as C,f as P,g as R,h as k,i as v,j as u,k as w,l as U,m as $,n as N,p as y,r as B,q as D,s as M,t as q,v as F,x as g,y as H,z as J,A as L,B as K,C as W,D as j,F as z,G}from"./vendor.2f5e2848.js";const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerpolicy&&(i.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?i.credentials="include":e.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(e){if(e.ep)return;e.ep=!0;const i=a(e);fetch(e.href,i)}};Y();const T=b({id:"account",state:()=>({access:{expires:"",token:""},refresh:{expires:"",token:""},user:{id:"",email:"",name:"",role:""},loggedIn:!1}),getters:{},actions:{setTokens(c){this.access=c.access,this.refresh=c.refresh,this.saveTokensToLocalStorage()},setUser(c){this.user=c,this.saveUserToLocalStorage()},saveTokensToLocalStorage(){console.log("Saving Tokens..."),localStorage.setItem("ref",btoa(JSON.stringify(this.refresh)))},saveUserToLocalStorage(){console.log("Saving User..."),localStorage.setItem("usr",btoa(JSON.stringify(this.user)))},getFromLocalStorage(){const c=localStorage.getItem("ref");c&&(this.refresh=JSON.parse(atob(c)));const t=localStorage.getItem("usr");t&&(this.user=JSON.parse(atob(t)))},resetLocalStorage(){localStorage.removeItem("ref"),localStorage.removeItem("usr")}}});const Q=v("div",{class:"logo"},"Social Survey App",-1),X=u("Surveys "),Z=u("List Surveys"),ee=u("Create a Survey"),te=u("Categories"),se=u(" List Categories "),oe=u(" Create a Category "),re=u("Users "),ae=u("List Users"),ne=u(" Logout "),ie={name:"MainView"},ce=Object.assign(ie,{setup(c){const t=T();function a(){t.resetLocalStorage(),location.reload()}return(n,e)=>{const i=w,s=I,l=A,_=V,d=U,O=$,x=N;return h(),m("div",null,[o(x,{class:"layout-container-main"},{default:r(()=>[o(O,{width:"256px"},{default:r(()=>[o(d,null,{default:r(()=>[o(_,{"default-openeds":["surveys","surveys-categories","users"],style:{"min-height":"100vh"},router:!0},{default:r(()=>[o(f(C),{to:"/"},{default:r(()=>[Q]),_:1}),o(l,{index:"surveys"},{title:r(()=>[o(i,null,{default:r(()=>[o(f(P))]),_:1}),X]),default:r(()=>[o(s,{index:"list-surveys"},{default:r(()=>[Z]),_:1}),o(s,{index:"create-survey"},{default:r(()=>[ee]),_:1}),o(l,{index:"surveys-categories"},{title:r(()=>[te]),default:r(()=>[o(s,{index:"list-categories"},{default:r(()=>[se]),_:1}),o(s,{index:"create-category"},{default:r(()=>[oe]),_:1})]),_:1})]),_:1}),o(l,{index:"users"},{title:r(()=>[o(i,null,{default:r(()=>[o(f(R))]),_:1}),re]),default:r(()=>[o(s,{index:"list-users"},{default:r(()=>[ae]),_:1})]),_:1}),o(s,{index:"logout",class:"bottom-item",onClick:a},{default:r(()=>[ne]),_:1})]),_:1})]),_:1})]),_:1}),o(x,null,{default:r(()=>[o(f(k))]),_:1})]),_:1})])}}});function le(){async function c(a,n){return(await y.post("https://socialsurveyapp.software/api/v1/auth/login",{email:a,password:n})).data}async function t(a){return(await y.post("https://socialsurveyapp.software/api/v1/auth/refresh-tokens",{refreshToken:a})).data}return{login:c,refreshTokens:t}}function ue(){async function c(t,a){return(await y.get(`https://socialsurveyapp.software/api/v1/users/${a}`,{headers:{Authorization:`Bearer ${t}`}})).data}return{getUser:c}}const _e={key:0,class:"page-loader"},de={setup(c){const t=T(),{refreshTokens:a}=le(),{getUser:n}=ue(),e=B(!0),i=D(),s=M();return q(()=>i.name,async l=>{l==="login"&&t.loggedIn&&s.push("/")}),F(async()=>{if(t.getFromLocalStorage(),t.refresh.token&&t.user.id){let l;try{l=await a(t.refresh.token)}catch(d){return console.error(d),g.alert("Please login again.","Session expired",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}let _;try{_=await n(l.access.token,t.user.id)}catch(d){return console.error(d),g.alert("Please login again.","Unknwon error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}if(_&&_.role==="admin"){t.setTokens(l),t.setUser(_),e.value=!1,t.loggedIn=!0,i.name==="login"&&s.push("/");return}else return g.alert("User does not have required privileges!","Error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,s.push("login")}else s.push("login"),e.value=!1}),(l,_)=>{const d=w;return h(),m("div",null,[e.value?(h(),m("div",_e,[o(d,{class:"is-loading"},{default:r(()=>[o(f(H))]),_:1})])):J("",!0),f(t).loggedIn?(h(),L(ce,{key:2})):(h(),L(f(k),{key:1}))])}}},fe="modulepreload",E={},pe="/admin/",p=function(t,a){return!a||a.length===0?t():Promise.all(a.map(n=>{if(n=`${pe}${n}`,n in E)return;E[n]=!0;const e=n.endsWith(".css"),i=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${i}`))return;const s=document.createElement("link");if(s.rel=e?"stylesheet":fe,e||(s.as="script",s.crossOrigin=""),s.href=n,document.head.appendChild(s),e)return new Promise((l,_)=>{s.addEventListener("load",l),s.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())};var he=(c,t)=>{const a=c.__vccOpts||c;for(const[n,e]of t)a[n]=e;return a};const me={},ge={class:"main"},ve=v("div",{class:"card-header"},[v("span",null,"Welcome!")],-1),ye=u(" You can use the sidebar to navigate through the admin dashboard. ");function Se(c,t){const a=K;return h(),m("div",ge,[o(a,{class:"box-card"},{header:r(()=>[ve]),default:r(()=>[ye]),_:1})])}var xe=he(me,[["render",Se]]);const Le=W({history:j(),routes:[{path:"/",name:"home",component:()=>xe},{path:"/login",name:"login",component:()=>p(()=>import("./LoginView.9802109d.js"),["assets/LoginView.9802109d.js","assets/LoginView.76e75d53.css","assets/el-form-item.1c8e9085.css","assets/vendor.2f5e2848.js","assets/vendor.079ea6c1.css"])},{path:"/list-surveys",name:"list-surveys",component:()=>p(()=>import("./ListSurveys.3bd8eff2.js"),["assets/ListSurveys.3bd8eff2.js","assets/ListSurveys.7e949cda.css","assets/el-form-item.1c8e9085.css","assets/vendor.2f5e2848.js","assets/vendor.079ea6c1.css","assets/survey.9daf437d.js","assets/survey.260332f5.css"])},{path:"/create-survey",name:"create-survey",component:()=>p(()=>import("./CreateSurvey.3fa51f9e.js"),["assets/CreateSurvey.3fa51f9e.js","assets/CreateSurvey.9316cb9e.css","assets/el-form-item.1c8e9085.css","assets/vendor.2f5e2848.js","assets/vendor.079ea6c1.css","assets/survey.9daf437d.js","assets/survey.260332f5.css"])},{path:"/list-categories",name:"list-categories",component:()=>p(()=>import("./ListCategories.a27367fc.js"),["assets/ListCategories.a27367fc.js","assets/ListCategories.ef0c91d9.css","assets/vendor.2f5e2848.js","assets/vendor.079ea6c1.css"])},{path:"/create-category",name:"create-category",component:()=>p(()=>import("./CreateCategory.6080eb10.js"),["assets/CreateCategory.6080eb10.js","assets/ListCategories.ef0c91d9.css","assets/vendor.2f5e2848.js","assets/vendor.079ea6c1.css"])},{path:"/list-users",name:"list-users",component:()=>p(()=>import("./ListUsers.f7f2dd81.js"),["assets/ListUsers.f7f2dd81.js","assets/ListCategories.ef0c91d9.css","assets/vendor.2f5e2848.js","assets/vendor.079ea6c1.css"])}]});const S=z(de);S.use(G());S.use(Le);S.mount("#app");export{he as _,le as a,T as u};
