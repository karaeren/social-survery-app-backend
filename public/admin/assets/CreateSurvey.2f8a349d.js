import{s as ne,r as h,O as G,t as se,v as re,x as y,I as ue,J as ie,S as de,T as ce,U as me,K as pe,L as fe,G as ye,Z as _e,_ as we,l as ge,o as d,c as _,e as l,w as a,u as s,W as k,X as V,A as p,z as b,i as x,j as f,$ as ve,a0 as he,a1 as ke,a2 as Ve,a3 as be}from"./vendor.9334939d.js";/* empty css                *//* empty css                     */import{g as U}from"./geoFeatures.22dc769d.js";/* empty css               */import{u as xe}from"./index.3a516315.js";import{u as Te}from"./survey.d4889153.js";const Ce={class:"main centered-main"},Ie=f(" Remove Expiration "),Ae=f(" Add Custom Geographic Constraint "),Se=x("a",{href:"https://geojson.io/",target:"_blank"}," geojson.io ",-1),Ee=f(" Add Custom Geographic Constraint "),Ue={class:"question-box-no",style:{"margin-bottom":"16px"}},De=x("h3",{style:{"margin-right":"12px"}},"Questions",-1),Me=f("Add Question"),Be={class:"question-box-no"},Oe={style:{margin:"0 12px"}},qe=f(" Delete "),je=f(" Add Answer "),Fe=f(" Create Survey "),Je={setup(Qe){const I={},T=xe(),{getSurveys:Y,createSurvey:$,getCategories:K}=Te(),N=ne(),A=h([]),D=h([]),M=h([]),w={lastId:3,1:3,2:3},z=["multiple-choice","slider","ranking"],g=h([]),n=G({name:"",description:"",categoryId:"",expireDate:null,geoFeatures:[],questions:[{questionId:1,questionText:"Question 1",questionType:"multiple-choice",answers:[{answerId:1,answerText:"Answer 1"},{answerId:2,answerText:"Answer 2"}]},{questionId:2,questionText:"Question 2",questionType:"multiple-choice",answers:[{answerId:1,answerText:"Answer 1"},{answerId:2,answerText:"Answer 2"}]}]});se(n,()=>{for(const t of n.questions)t.questionType==="slider"&&(t.answers.length>1&&t.answers.splice(1),t.answers[0].sliderMin||(t.answers[0].sliderMin=0),t.answers[0].sliderMax||(t.answers[0].sliderMax=100))});const B=Object.keys(U),C=h(!1),c=G({name:"",geojson:""}),O=(t,e,u)=>{const i=t[e];t[e]=t[u],t[u]=i},L=t=>{n.questions.splice(t,1)},J=()=>{const t=w.lastId;w[t]=3,w.lastId++,n.questions.push({questionId:t,questionText:"Question "+t,questionType:"multiple-choice",answers:[{answerId:1,answerText:"Answer 1"},{answerId:2,answerText:"Answer 2"}]})};re(async()=>{if(!!T.access.token){try{A.value=await K(T.access.token)}catch(t){return console.error(t),y.alert("An unknown error happened while trying to retrieve categories...","Error",{confirmButtonText:"OK"})}for await(const t of A.value)D.value.push({id:t.id,text:t.name,value:t.name});await P()}});async function P(){M.value=[];let t;try{t=await Y(T.access.token)}catch(e){return console.error(e),y.alert("An unknown error happened while trying to retrieve list of surveys...","Error",{confirmButtonText:"OK"})}await R(t)}async function R(t){for await(const e of t.results){const u=A.value.filter(i=>i.id===e.categoryId);M.value.push({id:e.id,name:e.name,description:e.description,categoryId:e.categoryId,category:u.length?u[0].name:"Unknown Category",submissionCount:e.submissionCount})}}function q(t,e){e==="up"&&t===0||e==="down"&&t===n.questions.length-1||(e==="up"?O(n.questions,t,t-1):e==="down"&&O(n.questions,t,t+1))}function W(t,e){n.questions[t].answers.splice(e,1)}function X(t){const e=w[n.questions[t].questionId];w[n.questions[t].questionId]++,n.questions[t].answers.push({answerId:e,answerText:"Answer "+e})}function Z(){if(!c.name||!c.geojson)return y.alert("Please fill all areas!","Error",{confirmButtonText:"OK"});let t={};try{t.name=c.name;const e=JSON.parse(c.geojson);t.type=e.features[0].geometry.type,t.coordinates=e.features[0].geometry.coordinates}catch(e){return y.alert("An error happened while trying to parse your input: "+e.message,"Error",{confirmButtonText:"OK"})}I[c.name]=t,B.push(c.name),g.value.push(c.name),c.name="",c.geojson="",C.value=!1}async function H(){if(n.geoFeatures=[],g.value.length>0)for(const e of g.value)Object.keys(U).includes(e)?n.geoFeatures.push(U[e]):Object.keys(I).includes(e)&&n.geoFeatures.push(I[e]);let t;try{t=await $(T.access.token,n)}catch(e){console.error(e);let u="An unknown error happened while trying to create the survey...";return e.response&&e.response.data.message&&(u=e.response.data.message),y.alert(u,"Error",{confirmButtonText:"OK"})}console.log(t),y.alert("Survey created successfully.","Success!",{confirmButtonText:"OK",callback:()=>{N.push("list-surveys")}})}return(t,e)=>{const u=ue,i=ie,S=de,E=ce,ee=me,m=pe,j=fe,te=ye,oe=_e,le=we,ae=ge;return d(),_("div",Ce,[l(ae,{class:"scrollbar-box"},{default:a(()=>[l(j,{model:s(n),"label-position":"left"},{default:a(()=>[l(i,{label:"Name","label-width":"180px"},{default:a(()=>[l(u,{modelValue:s(n).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(n).name=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(i,{label:"Description","label-width":"180px"},{default:a(()=>[l(u,{modelValue:s(n).description,"onUpdate:modelValue":e[1]||(e[1]=o=>s(n).description=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(i,{label:"Category","label-width":"180px"},{default:a(()=>[l(E,{modelValue:s(n).categoryId,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).categoryId=o),placeholder:"Please select a category"},{default:a(()=>[(d(!0),_(k,null,V(D.value,o=>(d(),p(S,{key:o.id,label:o.value,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"Expiration Date","label-width":"180px"},{default:a(()=>[l(ee,{modelValue:s(n).expireDate,"onUpdate:modelValue":e[3]||(e[3]=o=>s(n).expireDate=o),type:"date",placeholder:"Pick a day",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),l(m,{style:{"margin-left":"1em"},onClick:e[4]||(e[4]=o=>s(n).expireDate=null)},{default:a(()=>[Ie]),_:1})]),_:1}),l(i,{label:"Geographic Constraints","label-width":"180px"},{default:a(()=>[l(E,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),multiple:"",placeholder:"Select",style:{width:"240px"}},{default:a(()=>[(d(!0),_(k,null,V(s(B),o=>(d(),p(S,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(m,{style:{"margin-left":"1em"},onClick:e[6]||(e[6]=o=>C.value=!C.value)},{default:a(()=>[Ae]),_:1})]),_:1}),C.value?(d(),p(i,{key:0,label:"Add Custom Constraint","label-width":"180px"},{default:a(()=>[Se,l(u,{modelValue:s(c).name,"onUpdate:modelValue":e[7]||(e[7]=o=>s(c).name=o),placeholder:"Custom constraint name"},null,8,["modelValue"]),l(u,{modelValue:s(c).geojson,"onUpdate:modelValue":e[8]||(e[8]=o=>s(c).geojson=o),rows:2,type:"textarea",placeholder:"GeoJSON"},null,8,["modelValue"]),l(m,{onClick:Z},{default:a(()=>[Ee]),_:1})]),_:1})):b("",!0)]),_:1},8,["model"]),x("div",Ue,[De,l(m,{onClick:J},{default:a(()=>[Me]),_:1})]),l(le,{style:{"padding-left":"0"}},{default:a(()=>[(d(!0),_(k,null,V(s(n).questions,(o,v)=>(d(),p(oe,{key:o.questionId,center:""},{default:a(()=>[l(te,null,{default:a(()=>[x("div",Be,[l(m,{type:"primary",icon:s(ve),size:"small",circle:"",onClick:r=>q(v,"up")},null,8,["icon","onClick"]),l(m,{type:"primary",icon:s(he),size:"small",circle:"",onClick:r=>q(v,"down")},null,8,["icon","onClick"]),x("h4",Oe," Question #"+ke(o.questionId),1),l(m,{type:"danger",icon:s(Ve),size:"small",circle:"",onClick:r=>L(v)},null,8,["icon","onClick"])]),l(j,{ref_for:!0,ref:"formRef",model:o,"label-width":"120px","label-position":"left",style:{"margin-top":"1rem"}},{default:a(()=>[l(i,{prop:"name",label:"Question"},{default:a(()=>[l(u,{modelValue:o.questionText,"onUpdate:modelValue":r=>o.questionText=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{prop:"question_type",label:"Question type"},{default:a(()=>[l(E,{modelValue:o.questionType,"onUpdate:modelValue":r=>o.questionType=r,class:"m-2",placeholder:"Select",size:"large"},{default:a(()=>[(d(),_(k,null,V(z,r=>l(S,{key:r,value:r},null,8,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),(d(!0),_(k,null,V(o.answers,(r,F)=>(d(),p(i,{key:r.key,label:"Answer",prop:"answers."+F+".value"},{default:a(()=>[l(u,{modelValue:r.answerText,"onUpdate:modelValue":Q=>r.answerText=Q},null,8,["modelValue","onUpdate:modelValue"]),o.questionType!=="slider"?(d(),p(m,{key:0,style:{"margin-top":"0.5rem"},onClick:be(Q=>W(v,F),["prevent"])},{default:a(()=>[qe]),_:2},1032,["onClick"])):b("",!0)]),_:2},1032,["prop"]))),128)),o.questionType==="slider"?(d(),p(i,{key:0,label:"Slider Min"},{default:a(()=>[l(u,{modelValue:o.answers[0].sliderMin,"onUpdate:modelValue":r=>o.answers[0].sliderMin=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):b("",!0),o.questionType==="slider"?(d(),p(i,{key:1,label:"Slider Max"},{default:a(()=>[l(u,{modelValue:o.answers[0].sliderMax,"onUpdate:modelValue":r=>o.answers[0].sliderMax=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):b("",!0),l(i,null,{default:a(()=>[o.questionType!=="slider"?(d(),p(m,{key:0,onClick:r=>X(v)},{default:a(()=>[je]),_:2},1032,["onClick"])):b("",!0)]),_:2},1024)]),_:2},1032,["model"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(m,{type:"primary",onClick:H},{default:a(()=>[Fe]),_:1})]),_:1})])}}};export{Je as default};
