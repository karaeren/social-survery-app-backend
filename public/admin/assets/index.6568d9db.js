import{d as S,a as f,r as _,u as y,o as k,E as l,b as L,c as d,e as h,f as u,w as T,g,l as w,h as E,R as O,i as x,j as U,k as b,m as A}from"./vendor.8979cdfa.js";const I=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(e){if(e.ep)return;e.ep=!0;const r=n(e);fetch(e.href,r)}};I();const P=S({id:"account",state:()=>({access:{expires:"",token:""},refresh:{expires:"",token:""},user:{id:"",email:"",name:"",role:""}}),getters:{},actions:{setTokens(a){this.access=a.access,this.refresh=a.refresh,this.saveTokensToLocalStorage()},setUser(a){this.user=a,this.saveUserToLocalStorage()},saveTokensToLocalStorage(){console.log("Saving Tokens..."),localStorage.setItem("ref",btoa(JSON.stringify(this.refresh)))},saveUserToLocalStorage(){console.log("Saving User..."),localStorage.setItem("usr",btoa(JSON.stringify(this.user)))},getFromLocalStorage(){const a=localStorage.getItem("ref");a&&(this.refresh=JSON.parse(atob(a)));const t=localStorage.getItem("usr");t&&(this.user=JSON.parse(atob(t)))},resetLocalStorage(){localStorage.removeItem("ref"),localStorage.removeItem("usr")}}});function N(){async function a(n,s){return(await f.post("https://socialsurveyapp.software/api/v1/auth/login",{email:n,password:s})).data}async function t(n){return(await f.post("https://socialsurveyapp.software/api/v1/auth/refresh-tokens",{refreshToken:n})).data}return{login:a,refreshTokens:t}}function R(){async function a(t,n){return(await f.get(`https://socialsurveyapp.software/api/v1/users/${n}`,{headers:{Authorization:`Bearer ${t}`}})).data}return{getUser:a}}const B={key:0,class:"page-loader"},$={setup(a){const t=P(),{refreshTokens:n}=N(),{getUser:s}=R(),e=_(!0),r=y();return k(async()=>{if(t.getFromLocalStorage(),t.refresh.token&&t.user.id){let o;try{o=await n(t.refresh.token)}catch(c){return console.error(c),l.alert("Please login again.","Session expired",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,r.push("login")}let i;try{i=await s(o.access.token,t.user.id)}catch(c){return console.error(c),l.alert("Please login again.","Unknwon error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,r.push("login")}if(i&&i.role==="admin")t.setTokens(o),t.setUser(i),e.value=!1;else return l.alert("User does not have required privileges!","Error",{confirmButtonText:"OK"}),t.resetLocalStorage(),e.value=!1,r.push("login")}else r.push("login"),e.value=!1}),(o,i)=>{const c=L;return d(),h("div",null,[e.value?(d(),h("div",B,[u(c,{class:"is-loading"},{default:T(()=>[u(g(w))]),_:1})])):E("",!0),u(g(O))])}}},C="modulepreload",m={},V="/admin/",v=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${V}${s}`,s in m)return;m[s]=!0;const e=s.endsWith(".css"),r=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const o=document.createElement("link");if(o.rel=e?"stylesheet":C,e||(o.as="script",o.crossOrigin=""),o.href=s,document.head.appendChild(o),e)return new Promise((i,c)=>{o.addEventListener("load",i),o.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())},J=x({history:U(),routes:[{path:"/",name:"home",component:()=>v(()=>import("./HomeView.574f2bec.js"),["assets/HomeView.574f2bec.js","assets/vendor.8979cdfa.js","assets/vendor.a1c01f9f.css"])},{path:"/login",name:"login",component:()=>v(()=>import("./LoginView.dc4980f7.js"),["assets/LoginView.dc4980f7.js","assets/LoginView.a60d55c3.css","assets/vendor.8979cdfa.js","assets/vendor.a1c01f9f.css"])}]});const p=b($);p.use(A());p.use(J);p.mount("#app");export{N as a,P as u};
