import{r as m,N as ee,O as A,v as te,x as f,P as oe,I as ae,K as le,Q as ne,J as re,S as se,T as ue,U as ie,L as de,V as ce,o as y,c as F,i as O,e as a,u as s,w as n,W as S,X as Y,A as B,z as pe,j as d,Y as T}from"./vendor.9334939d.js";/* empty css                  *//* empty css                     */import{g as k}from"./geoFeatures.22dc769d.js";/* empty css               *//* empty css                        */import{u as me}from"./index.3a516315.js";import{u as fe}from"./survey.d4889153.js";const ge={class:"main centered-main"},ye=d(" Results "),ve=d(" Edit "),_e=d(" Delete "),he=d(" Remove Expiration "),we=d(" Add Custom Geographic Constraint "),be=O("a",{href:"https://geojson.io/",target:"_blank"}," geojson.io ",-1),xe=d(" Add Custom Geographic Constraint "),Ce={class:"dialog-footer"},ke=d("Cancel"),De=d(" Update "),Ue={setup(Ve){const h={},v=me(),{getSurveys:G,updateSurvey:N,deleteSurvey:K,getCategories:M}=fe(),D=m([]),V=m([]),w=m([]),b=m(""),$=ee(()=>w.value.filter(t=>!b.value||t.name.toLowerCase().includes(b.value.toLowerCase()))),_=m(!1),c=m([]),l=A({id:"",name:"",description:"",category:"",expireDate:null,geoFeatures:[]}),x=Object.keys(k),C=m(!1),u=A({name:"",geojson:""});te(async()=>{if(!!v.access.token){try{D.value=await M(v.access.token)}catch(t){return console.error(t),f.alert("An unknown error happened while trying to retrieve categories...","Error",{confirmButtonText:"OK"})}for await(const t of D.value)V.value.push({id:t.id,text:t.name,value:t.name});await E()}});async function E(){w.value=[];let t;try{t=await G(v.access.token)}catch(e){return console.error(e),f.alert("An unknown error happened while trying to retrieve list of surveys...","Error",{confirmButtonText:"OK"})}await L(t)}async function L(t){for await(const e of t.results){const r=D.value.filter(p=>p.id===e.categoryId);w.value.push({id:e.id,name:e.name,description:e.description,categoryId:e.categoryId,expireDate:e.expireDate?new Date(e.expireDate).toISOString().split("T")[0]:null,numFeatures:e.geoFeatures?e.geoFeatures.length:0,geoFeatures:e.geoFeatures,category:r.length?r[0].name:"Unknown Category",submissionCount:e.submissionCount})}}function z(t,e){return e.category===t}function P(t){window.open(`https://socialsurveyapp.software/results/#/?surveyId=${t}`,"_blank")}function J(t){for(const e of w.value)if(e.id===t){l.id=t,l.name=e.name,l.description=e.description,l.category=e.categoryId,l.expireDate=e.expireDate,l.geoFeatures=e.geoFeatures,_.value=!0,c.value=[];for(const r of l.geoFeatures)c.value.push(r.name),x.includes(r.name)||x.push(u.name),Object.keys(k).includes(r.name)||(h[r.name]={name:r.name,type:r.type,coordinates:r.coordinates});return}}function R(){if(!u.name||!u.geojson)return f.alert("Please fill all areas!","Error",{confirmButtonText:"OK"});let t={};try{t.name=u.name;const e=JSON.parse(u.geojson);t.type=e.features[0].geometry.type,t.coordinates=e.features[0].geometry.coordinates}catch(e){return f.alert("An error happened while trying to parse your input: "+e.message,"Error",{confirmButtonText:"OK"})}h[u.name]=t,x.push(u.name),c.value.push(u.name),u.name="",u.geojson="",C.value=!1}async function W(){if(l.geoFeatures=[],c.value.length>0)for(const t of c.value)Object.keys(k).includes(t)?l.geoFeatures.push(k[t]):Object.keys(h).includes(t)&&l.geoFeatures.push(h[t]);try{await N(v.access.token,l.id,l.name,l.description,l.category,l.expireDate,l.geoFeatures),T({type:"success",message:"Survey updated"}),await E(),_.value=!1}catch(t){return console.error(t),f.alert("Couldn't update survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}function Q(t){f.confirm("Are you sure you want to delete this survey? This is irreversible!","Warning",{confirmButtonText:"Yes",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{try{await K(v.access.token,t),T({type:"success",message:"Delete completed"}),await E()}catch(e){return console.error(e),f.alert("Couldn't delete survey, an unknown error happened...","Error",{confirmButtonText:"OK"})}}).catch(()=>{T({type:"info",message:"Delete canceled"})})}return(t,e)=>{const r=oe,p=ae,i=le,X=ne,g=re,I=se,j=ue,q=ie,H=de,Z=ce;return y(),F(S,null,[O("div",ge,[a(X,{data:s($),height:"100vh",style:{width:"100%"}},{default:n(()=>[a(r,{fixed:"",prop:"name",label:"Name",sortable:"",width:"240"}),a(r,{prop:"description",label:"Description",width:"360"}),a(r,{prop:"expireDate",label:"Expire Date",width:"240"}),a(r,{prop:"numFeatures",label:"Geographic Features",width:"240"}),a(r,{prop:"submissionCount",label:"Submission Count",width:"240"}),a(r,{prop:"category",label:"Category",sortable:"",filters:V.value,"filter-method":z,width:"240"},null,8,["filters"]),a(r,{prop:"id",label:"ID",sortable:"",width:"360"}),a(r,{fixed:"right",align:"right","min-width":"240"},{header:n(()=>[a(p,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:n(o=>[a(i,{type:"success",size:"small",onClick:U=>P(o.row.id)},{default:n(()=>[ye]),_:2},1032,["onClick"]),a(i,{type:"primary",size:"small",onClick:U=>J(o.row.id)},{default:n(()=>[ve]),_:2},1032,["onClick"]),a(i,{type:"danger",size:"small",onClick:U=>Q(o.row.id)},{default:n(()=>[_e]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),a(Z,{modelValue:_.value,"onUpdate:modelValue":e[11]||(e[11]=o=>_.value=o),title:"Update Survey"},{footer:n(()=>[O("span",Ce,[a(i,{onClick:e[10]||(e[10]=o=>_.value=!1)},{default:n(()=>[ke]),_:1}),a(i,{type:"primary",onClick:W},{default:n(()=>[De]),_:1})])]),default:n(()=>[a(H,{model:s(l)},{default:n(()=>[a(g,{label:"Name","label-width":"180px"},{default:n(()=>[a(p,{modelValue:s(l).name,"onUpdate:modelValue":e[1]||(e[1]=o=>s(l).name=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(g,{label:"Description","label-width":"180px"},{default:n(()=>[a(p,{modelValue:s(l).description,"onUpdate:modelValue":e[2]||(e[2]=o=>s(l).description=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(g,{label:"Category","label-width":"180px"},{default:n(()=>[a(j,{modelValue:s(l).category,"onUpdate:modelValue":e[3]||(e[3]=o=>s(l).category=o),placeholder:"Please select a category"},{default:n(()=>[(y(!0),F(S,null,Y(V.value,o=>(y(),B(I,{key:o.id,label:o.value,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"Expiration Date","label-width":"180px"},{default:n(()=>[a(q,{modelValue:s(l).expireDate,"onUpdate:modelValue":e[4]||(e[4]=o=>s(l).expireDate=o),type:"date",placeholder:"Pick a day",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),a(i,{style:{"margin-left":"1em"},onClick:e[5]||(e[5]=o=>s(l).expireDate=null)},{default:n(()=>[he]),_:1})]),_:1}),a(g,{label:"Geographic Constraints","label-width":"180px"},{default:n(()=>[a(j,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value=o),multiple:"",placeholder:"Select",style:{width:"240px"}},{default:n(()=>[(y(!0),F(S,null,Y(s(x),o=>(y(),B(I,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(i,{style:{"margin-left":"1em"},onClick:e[7]||(e[7]=o=>C.value=!C.value)},{default:n(()=>[we]),_:1})]),_:1}),C.value?(y(),B(g,{key:0,label:"Add Custom Constraint","label-width":"180px"},{default:n(()=>[be,a(p,{modelValue:s(u).name,"onUpdate:modelValue":e[8]||(e[8]=o=>s(u).name=o),placeholder:"Custom constraint name"},null,8,["modelValue"]),a(p,{modelValue:s(u).geojson,"onUpdate:modelValue":e[9]||(e[9]=o=>s(u).geojson=o),rows:2,type:"textarea",placeholder:"GeoJSON"},null,8,["modelValue"]),a(i,{onClick:R},{default:n(()=>[xe]),_:1})]),_:1})):pe("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{Ue as default};
